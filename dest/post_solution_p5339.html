<!--
题解 P5339 【[TJOI2019]唱、跳、rap和篮球】
容斥，枚举k表示至少k组讨论cxk的同学，它对答案的贡献为两部分相乘：
-->
<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>题解 P5339 【[TJOI2019]唱、跳、rap和篮球】 -- Wycero's blog</title>
<link rel="stylesheet" type="text/css" href="wycero-1.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/katex.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/contrib/auto-render.js"></script>
<link href="http://cdn.bootcss.com/highlight.js/8.0/styles/monokai_sublime.min.css" rel="stylesheet">  
<script src="http://cdn.bootcss.com/highlight.js/8.0/highlight.min.js"></script>  
<script >hljs.initHighlightingOnLoad();</script>  
<link href="icon.png" rel="Shortcut Icon">
</head>
<body id="body">
<div class="top-bar">
<a href="index.html" class="tpi icon-top"><img src="home.svg" class="svg"></img></a>
<p class="tpi">题解 P5339 【[TJOI2019]唱、跳、rap和篮球】</p>
<a href="#" class="tpi icon-top"><img src="top.svg" class="svg"></img></a></div>
<br><br><br><br>
<p><del>鸡你太美</del> </p>
<p>容斥，枚举$k$表示至少$k$组讨论cxk的同学，它对答案的贡献为两部分相乘： </p>
<p>1. 在$n$个同学的序列中放置$k$组讨论cxk的同学，这个可以简单dp出来：$dp_{i,j}=dp_{i-1,j}+dp_{i-4,j-1}$ </p>
<p>2. 不一定讨论cxk的同学如何排列，即从人数分别为$a-4k,b-4k,c-4k,d-4k$（以下记作$A,B,C,D$）的4组同学中选出总数为$n-4k$（以下记作$N$）的同学。 </p>
<p>如果$A+B+C+D=N$，那么就是可重排列问题，答案为$\frac{N!}{A!B!C!D!}$。 </p>
<p>如果$A+B+C+D>N$呢？那么我们就枚举$=N$的部分，答案为： </p>
<p>$\sum\limits_{i=0}^A\sum\limits_{j=0}^B\sum\limits_{k=0}^C\sum\limits_{l=0}^D[i+j+k+l=N]\frac{N!}{i!j!k!l!}$ </p>
<p>$=N!\sum\limits_{i=0}^A\sum\limits_{j=0}^B\sum\limits_{k=0}^C\sum\limits_{l=0}^D[i+j+k+l=N]\frac 1{i!}\frac 1{j!}\frac 1{k!}\frac 1{l!}$ </p>
<p>看到你了！卷积！ </p>
<p>NTT </p>
<p>$O(n^2 log n)$</p>
<pre><code class=cpp>#include&ltbits/stdc++.h&gt
#define rep(i,a,b) for(int i=(a);i&lt=(b);i++)
using namespace std;
typedef long long int ll;
const ll maxn=20005;
int n,a,b,c,d;const ll xrj=998244353;
ll dp[2005][2005];
ll wn[25],wn2[25];
ll ksm(ll d,ll z){
	ll ans=1;while(z){
		if(z&amp1)ans=ans*d%xrj;
		d=d*d%xrj;
		z&gt&gt=1;}
	return ans;}
ll r[maxn];
void ntt(ll *a,ll l,int on){
	//rep(i,0,(1&lt&ltl)-1)cout&lt&lta[i]&lt&lt&quotv&quot;;cout&lt&ltendl;
	rep(i,0,(1&lt&ltl)-1)r[i]=(r[i&gt&gt1]&gt&gt1)|((i&amp1)&lt&lt(l-1));
	rep(i,0,(1&lt&ltl)-1)if(i&ltr[i])swap(a[i],a[r[i]]);
	rep(i,0,l-1){
		int j=1&lt&lti;
		ll x=on==-1?wn2[i+1]:wn[i+1];for(int k=0;k&lt1&lt&ltl;k+=j&lt&lt1){
			ll y=1;rep(m,0,j-1){
				ll p=a[k+m],q=y*a[k+j+m]%xrj;
				a[k+m]=(p+q)%xrj;
				a[k+j+m]=(p+xrj-q)%xrj;
				(y*=x)%=xrj;}}}
	if(on==-1){
		ll ny=ksm(1&lt&ltl,xrj-2);
		rep(i,0,(1&lt&ltl)-1)(a[i]*=ny)%=xrj;}
	/*rep(i,0,(1&lt&ltl)-1)cout&lt&lta[i]&lt&lt&quot^&quot;;cout&lt&ltendl;*/}
ll jc[maxn],jcny[maxn];
ll aa[maxn],bb[maxn],cc[maxn],dd[maxn];
ll work(int n,int a,int b,int c,int d){
	//cout&lt&lt&quot#&quot&lt&ltn&lt&lt&quot &quot&lt&lta&lt&lt&quot &quot&lt&ltb&lt&lt&quot &quot&lt&ltc&lt&lt&quot &quot&lt&ltd&lt&ltendl;
	int l=0;while(1&lt&ltl&lt(a+b+c+d)&lt&lt1)++l;
#define haha(a,aa) rep(i,0,(1&lt&ltl)-1)aa[i]=i&lt=a?jcny[i]:0;
	haha(a,aa);haha(b,bb);haha(c,cc);haha(d,dd);
	ntt(aa,l,1);ntt(bb,l,1);ntt(cc,l,1);ntt(dd,l,1);
	rep(i,0,(1&lt&ltl)-1)aa[i]=aa[i]*bb[i]%xrj*cc[i]%xrj*dd[i]%xrj;
	ntt(aa,l,-1);
return aa[n]*jc[n]%xrj;}
int main(){
	cin&gt&gtn&gt&gta&gt&gtb&gt&gtc&gt&gtd;
	rep(i,0,n)dp[i][0]=1;
	rep(i,1,n)rep(j,1,n)dp[i][j]=(dp[i-1][j]+((i&gt=4)?dp[i-4][j-1]:0))%xrj;
	//rep(i,1,n){rep(j,0,n)cout&lt&ltdp[i][j]&lt&lt&quot &quot;;cout&lt&ltendl;}
	rep(i,0,19)wn[i]=ksm(3,(xrj-1)&gt&gti);
	rep(i,0,19)wn2[i]=ksm(wn[i],xrj-2);
	jc[0]=1;
	rep(i,1,4*n)jc[i]=jc[i-1]*i%xrj;
	jcny[4*n]=ksm(jc[4*n],xrj-2);
	for(int i=4*n-1;i&gt=0;i--)jcny[i]=jcny[i+1]*(i+1)%xrj;
	//rep(i,0,4*n)cout&lt&ltjc[i]&lt&lt&quot &quot;;cout&lt&ltendl;
	//rep(i,0,4*n)cout&lt&ltjcny[i]&lt&lt&quot &quot;;cout&lt&ltendl;
	int sgn=1;ll ans=0;
	int kk=min(n/4,min(a,min(b,min(c,d))));
	rep(k,0,kk){
		ll a1=work(n-4*k,a-k,b-k,c-k,d-k),a2=dp[n][k];
		//cout&lt&ltk&lt&lt&quot$&quot&lt&lta1&lt&lt&quot &quot&lt&lta2&lt&ltendl;
		(ans+=sgn*a1%xrj*a2%xrj)%=xrj;
		sgn=xrj-sgn;}
	cout&lt&ltans&lt&ltendl;
	return 0;}</pre></code><footer>
<script src="wycero-1.js"></script>
<p>Copyright 2019 wycero</p>
<p>Powered By: 
<a href="http://php.net">PHP</a>
<a href="https://katex.org">$\KaTeX$</a>
<a href="https://highlightjs.org/">Highlightjs</a></p>
<p>Hosted On coding.me</p>
</footer>
<script>
    renderMathInElement(document.body,
   {
              delimiters: [
                  {left: "$$", right: "$$", display: true},
                  {left: "$", right: "$", display: false},
                  {left: "\\(", right: "\\)", display: false}
              ]
          }
  );
</script>

</body>
</html>
